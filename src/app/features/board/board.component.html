<div class="board-tabs">
  <button [class.active]="tab === 'board'" (click)="tab = 'board'">
    Доска
  </button>
  <button [class.active]="tab === 'burn'" (click)="tab = 'burn'">График</button>
</div>

<div *ngIf="tab === 'board'" class="board-main-area">
  <div class="board-columns-outer">
    <div
      class="board-columns"
      cdkDropList
      [cdkDropListData]="columns"
      cdkDropListOrientation="horizontal"
      (cdkDropListDropped)="onColumnDrop($event)"
    >
      <app-board-column
        *ngFor="let col of sortedColumns; trackBy: trackByColId"
        [column]="col"
        [isDragging]="isDraggingColumnId === col.id"
        [addingTaskColumnId]="addingTaskColumnId"
        [connectedDropListsIds]="connectedDropListsIds"
        [getPriorityColor]="getPriorityColor"
        [getPriorityLabel]="getPriorityLabel"
        [editing]="editingColumnId === col.id"
        [editTitle]="editColumnTitle"
        [editColor]="editColumnColor"
        [editDescription]="editColumnDescription"
        [taskTypes]="taskTypes"
        (editColumn)="editColumn($event)"
        (saveEditColumn)="saveEditColumn($event)"
        (cancelEditColumn)="cancelEditColumn()"
        (addTask)="addTask($event)"
        (toggleAddTask)="toggleAddTask($event)"
        (cancelAddTask)="cancelAddTask()"
        (onTaskDrop)="onTaskDrop($event, col)"
        (openTaskDialog)="openTaskDialog($event)"
        (columnDragStarted)="onColumnDragStarted($event)"
        (columnDragEnded)="onColumnDragEnded()"
        (deleteColumn)="deleteColumn($event)"
      ></app-board-column>
      <div class="board-column board-column-add">
        <ng-container *ngIf="!addingColumn; else addColForm">
          <button
            class="add-column-btn"
            (click)="showAddColumnForm()"
            title="Добавить столбец"
          >
            + Добавить столбец
          </button>
        </ng-container>
        <ng-template #addColForm>
          <form
            class="add-column-form"
            (ngSubmit)="addColumn()"
            autocomplete="off"
          >
            <input
              class="add-col-input"
              type="text"
              [(ngModel)]="newColumnTitle"
              name="newColumnTitle"
              maxlength="32"
              required
              placeholder="Название столбца"
              autofocus
            />
            <textarea
              class="add-col-desc"
              [(ngModel)]="newColumnDescription"
              name="newColumnDescription"
              rows="3"
              maxlength="256"
              required
              placeholder="Описание столбца"
            ></textarea>
            <input
              class="add-col-color"
              type="color"
              [(ngModel)]="newColumnColor"
              name="newColumnColor"
              required
            />
            <button
              class="add-btn"
              type="submit"
              [disabled]="
                !newColumnTitle.trim() || !newColumnDescription.trim()
              "
            >
              +
            </button>
            <button
              class="cancel-btn"
              type="button"
              (click)="cancelAddColumn()"
            >
              ×
            </button>
          </form>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<div *ngIf="tab === 'burn'">
  <app-board-analytics
    [companyId]="companyId"
    [boardId]="boardId"
  ></app-board-analytics>
</div>
