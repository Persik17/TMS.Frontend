<div class="dashboard-settings" (scroll)="onScroll()">
  <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞</h2>
  <nav class="tabs">
    <button [class.active]="tab === 'info'" (click)="tab = 'info'">
      <span class="tab-icon">‚ÑπÔ∏è</span> –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è
    </button>
    <button [class.active]="tab === 'users'" (click)="tab = 'users'">
      <span class="tab-icon">üë•</span> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    </button>
  </nav>
  <section *ngIf="tab === 'info'" class="section">
    <h3>–û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –ø–æ –¥–æ—Å–∫–µ</h3>
    <div class="fields-grid">
      <div class="field">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
        <span>{{ board.name }}</span>
      </div>
      <div class="field">
        <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
        <span>{{ board.description }}</span>
      </div>
      <div class="field">
        <label>–û—Ç–¥–µ–ª:</label>
        <span>{{ board.department }}</span>
      </div>
      <div class="field">
        <label>–¢–∏–ø –¥–æ—Å–∫–∏:</label>
        <span>{{ board.boardType }}</span>
      </div>
      <div class="field">
        <label>–ü—Ä–∏–≤–∞—Ç–Ω–∞—è:</label>
        <span>{{ board.isPrivate ? "–î–∞" : "–ù–µ—Ç" }}</span>
      </div>
    </div>
  </section>
  <section *ngIf="tab === 'users'" class="section users-section">
    <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
    <div class="users-header">
      <button class="add-user-btn" (click)="addUser()">
        <span>+ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –ø–æ email</span>
      </button>
      <button
        class="save-matrix-btn"
        *ngIf="hasMatrixChanges"
        (click)="saveMatrixChanges()"
      >
        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
      </button>
    </div>
    <div class="users-list">
      <div class="user-row" *ngFor="let user of users">
        <div class="user-info">
          <div class="user-avatar">
            {{ user.name ? user.name[0] : user.email[0] }}
          </div>
          <div>
            <div class="user-name">{{ user.name || "(–±–µ–∑ –∏–º–µ–Ω–∏)" }}</div>
            <div class="user-email">{{ user.email }}</div>
          </div>
        </div>
        <div class="user-status-role">
          <span
            class="user-status"
            [class.invited]="user.status === '–ü—Ä–∏–≥–ª–∞—à—ë–Ω'"
          >
            {{ user.status }}
          </span>
        </div>
        <div class="user-permissions-matrix">
          <div
            class="perm-cell"
            *ngFor="let field of permissionFields"
            [attr.data-title]="permissionFieldLabels[field]"
          >
            <span class="perm-label-visible">
              {{ permissionFieldLabels[field] }}
            </span>
            <button
              class="perm-icon-btn"
              [disabled]="user.status !== '–ê–∫—Ç–∏–≤–Ω—ã–π'"
              [ngClass]="{ changed: isPermissionChanged(user, field) }"
              (click)="cyclePermission(user, field, $event)"
              (contextmenu)="openPermissionMenu(user, field, $event)"
              [title]="accessTitles[user.permissions[field]]"
              type="button"
            >
              {{ accessIcons[user.permissions[field]] }}
            </button>
          </div>
        </div>
        <button
          class="remove-user-btn"
          (click)="removeUser(user)"
          title="–£–¥–∞–ª–∏—Ç—å"
        >
          ‚úï
        </button>
      </div>
      <div *ngIf="users.length === 0" class="empty-users">
        –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      </div>
    </div>
  </section>

  <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–∞–≤ -->
  <div
    *ngIf="permissionMenuShow && permissionMenuUser && permissionMenuField"
    class="perm-menu"
    [ngStyle]="{ 'left.px': permissionMenuLeft, 'top.px': permissionMenuTop }"
    (mouseleave)="closePermissionMenu()"
    tabindex="0"
    (blur)="closePermissionMenu()"
  >
    <button
      *ngFor="let level of accessLevels"
      (mousedown)="selectPermission(level)"
      [ngClass]="{ selected: isSelected(level) }"
      type="button"
    >
      {{ accessIcons[level] }} {{ accessTitles[level] }}
    </button>
  </div>

  <!-- Invite User Modal -->
  <div
    class="invite-modal-backdrop"
    *ngIf="showInviteModal"
    (click)="closeModal()"
  ></div>
  <div class="invite-modal" *ngIf="showInviteModal">
    <h3>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
    <label for="inviteEmail">Email:</label>
    <input
      id="inviteEmail"
      type="email"
      [(ngModel)]="inviteEmail"
      (keydown.enter)="confirmInvite()"
      placeholder="user@example.com"
      autocomplete="off"
    />
    <div class="invite-error" *ngIf="inviteError">{{ inviteError }}</div>
    <div class="invite-actions">
      <button class="invite-confirm" (click)="confirmInvite()">
        –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å
      </button>
      <button class="invite-cancel" (click)="closeModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>
