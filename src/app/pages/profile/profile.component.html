<div class="profile-settings-card">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
  <nav class="settings-tabs">
    <button [class.active]="tab === 'info'" (click)="tab = 'info'">
      <span class="tab-icon">üë§</span> –û—Å–Ω–æ–≤–Ω–æ–µ
    </button>
    <button [class.active]="tab === 'system'" (click)="tab = 'system'">
      <span class="tab-icon">üñ•Ô∏è</span> –°–∏—Å—Ç–µ–º–Ω—ã–µ
    </button>
    <button [class.active]="tab === 'notif'" (click)="tab = 'notif'">
      <span class="tab-icon">üîî</span> –û–ø–æ–≤–µ—â–µ–Ω–∏—è
    </button>
    <button [class.active]="tab === 'security'" (click)="tab = 'security'">
      <span class="tab-icon">üîí</span> –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    </button>
  </nav>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ -->
  <section *ngIf="tab === 'info'" class="settings-section">
    <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
    <form (ngSubmit)="saveProfile()" #profileForm="ngForm" autocomplete="off">
      <div class="profile-info-grid">
        <div class="profile-info-col">
          <div class="info-row">
            <span class="info-label">–§–ò–û:</span>
            <input
              class="info-value editable"
              [(ngModel)]="user.fullName"
              name="fullName"
              required
            />
          </div>
          <div class="info-row">
            <span class="info-label">–Ø–∑—ã–∫:</span>
            <input
              class="info-value editable"
              [(ngModel)]="user.language"
              name="language"
            />
          </div>
          <div class="info-row">
            <span class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
            <input
              class="info-value editable"
              [(ngModel)]="user.phone"
              name="phone"
            />
          </div>
          <div class="info-row">
            <span class="info-label">Telegram ID:</span>
            <input
              class="info-value editable"
              [(ngModel)]="user.telegramId"
              name="telegramId"
            />
          </div>
        </div>
        <div class="profile-info-col">
          <div class="info-row">
            <span class="info-label">–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:</span>
            <input
              class="info-value editable"
              [(ngModel)]="user.timezone"
              name="timezone"
            />
          </div>
          <div class="info-row">
            <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
            <input
              class="info-value editable"
              [(ngModel)]="user.status"
              name="status"
            />
          </div>
          <div class="info-row">
            <span class="info-label">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</span>
            <span class="info-value">{{
              user?.registrationDate | date : "medium"
            }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</span>
            <span class="info-value">{{
              user?.lastLoginDate | date : "medium"
            }}</span>
          </div>
        </div>
      </div>
      <button
        class="primary-btn"
        type="submit"
        [disabled]="profileForm.invalid"
      >
        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
      </button>
    </form>
  </section>
  <!-- –°–∏—Å—Ç–µ–º–Ω—ã–µ -->
  <section *ngIf="tab === 'system'" class="settings-section">
    <h3>–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    <div class="settings-fields">
      <div class="field">
        <label>–¢–µ–º–∞:</label>
        <select class="styled-select" [(ngModel)]="systemSettings.theme">
          <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
          <option value="dark">–¢—ë–º–Ω–∞—è</option>
          <option value="system">–°–∏—Å—Ç–µ–º–Ω–∞—è</option>
        </select>
      </div>
      <div class="field board-bg-field">
        <label>–§–æ–Ω –¥–ª—è –¥–æ—Å–æ–∫:</label>
        <div class="board-bg-preview" [ngStyle]="getBoardBgStyle()">
          <ng-container
            *ngIf="
              systemSettings.boardBgType === 'custom' &&
              systemSettings.boardBgUrl
            "
          >
            <img [src]="systemSettings.boardBgUrl" alt="–§–æ–Ω –¥–æ—Å–æ–∫" />
          </ng-container>
          <ng-container *ngIf="systemSettings.boardBgType === 'template'">
            <img [src]="systemSettings.boardBgUrl" alt="–§–æ–Ω –¥–æ—Å–æ–∫" />
          </ng-container>
          <ng-container *ngIf="systemSettings.boardBgType === 'color'">
            <div
              class="board-bg-color"
              [style.background]="systemSettings.boardBgColor"
            ></div>
          </ng-container>
        </div>
        <button
          type="button"
          (click)="openBgModal()"
          class="primary-btn select-bg-btn"
        >
          –í—ã–±—Ä–∞—Ç—å —Ñ–æ–Ω
        </button>
        <div class="bg-file-name" *ngIf="systemSettings.boardBgName">
          {{ systemSettings.boardBgName }}
        </div>
      </div>
    </div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Ñ–æ–Ω–∞ -->
    <div class="bg-modal" *ngIf="bgModalOpen">
      <div class="bg-modal-backdrop" (click)="closeBgModal()"></div>
      <div class="bg-modal-content">
        <h4>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ–Ω –¥–ª—è –¥–æ—Å–æ–∫</h4>
        <div class="bg-templates">
          <div
            class="bg-template"
            *ngFor="let tpl of bgTemplates"
            [class.selected]="
              systemSettings.boardBgUrl === tpl.url &&
              systemSettings.boardBgType === 'template'
            "
            (click)="selectTemplateBg(tpl)"
          >
            <img [src]="tpl.url" [alt]="tpl.name" />
          </div>
        </div>
        <div class="bg-colors">
          <div
            class="bg-color-sample"
            *ngFor="let color of bgColors"
            [style.background]="color"
            [class.selected]="
              systemSettings.boardBgColor === color &&
              systemSettings.boardBgType === 'color'
            "
            (click)="selectColorBg(color)"
          ></div>
        </div>
        <div class="bg-upload">
          <label class="custom-file-upload">
            <input
              type="file"
              accept="image/*"
              (change)="onBoardBgUpload($event)"
            />
            <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ–π —Ñ–æ–Ω</span>
          </label>
        </div>
        <button class="primary-btn" (click)="closeBgModal()">–ì–æ—Ç–æ–≤–æ</button>
      </div>
    </div>
  </section>
  <!-- –û–ø–æ–≤–µ—â–µ–Ω–∏—è -->
  <section *ngIf="tab === 'notif'" class="settings-section">
    <h3>–û–ø–æ–≤–µ—â–µ–Ω–∏—è</h3>
    <div class="notification-hint">
      <span class="hint-icon">‚ÑπÔ∏è</span>
      <div>
        <b>SMS-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</b> –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:
        <ol>
          <li>
            <b>–°–Ω–∞—á–∞–ª–∞</b> –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å <span class="tg">Telegram</span>.
          </li>
          <li>–ï—Å–ª–∏ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ ‚Äî <b>E-mail</b>.</li>
          <li>–ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ ‚Äî <b>SMS</b> –Ω–∞ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.</li>
        </ol>
        <div class="hint-note">
          <b>–û–±—ã—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</b> (–æ —Å–æ–±—ã—Ç–∏—è—Ö, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ —Ç.–¥.)
          –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è <b>–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</b> –ø–æ –≤—Å–µ–º –∫–∞–Ω–∞–ª–∞–º:
          <span class="tg">Telegram</span>, <span class="mail">E-mail</span>,
          <span class="sms">SMS</span>.
        </div>
      </div>
    </div>
    <div class="notif-checkboxes-row">
      <label
        class="notif-checkbox"
        [class.changed]="
          user.notificationSettings.emailNotificationsEnabled !==
          originalNotif.emailNotificationsEnabled
        "
      >
        <input
          type="checkbox"
          [(ngModel)]="user.notificationSettings.emailNotificationsEnabled"
        />
        <span class="icon email"></span>
        Email
      </label>
      <label
        class="notif-checkbox"
        [class.changed]="
          user.notificationSettings.pushNotificationsEnabled !==
          originalNotif.pushNotificationsEnabled
        "
      >
        <input
          type="checkbox"
          [(ngModel)]="user.notificationSettings.pushNotificationsEnabled"
        />
        <span class="icon push"></span>
        Push
      </label>
      <label
        class="notif-checkbox"
        [class.changed]="
          user.notificationSettings.telegramNotificationsEnabled !==
          originalNotif.telegramNotificationsEnabled
        "
      >
        <input
          type="checkbox"
          [(ngModel)]="user.notificationSettings.telegramNotificationsEnabled"
        />
        <span class="icon telegram"></span>
        Telegram
      </label>
    </div>
    <button class="primary-btn" (click)="saveNotificationSettings()">
      –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
    </button>
  </section>
  <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
  <section *ngIf="tab === 'security'" class="settings-section">
    <h3>–°–º–µ–Ω–∞ Email –∏ –ø–∞—Ä–æ–ª—è</h3>
    <form
      (ngSubmit)="changeEmail()"
      #emailForm="ngForm"
      autocomplete="off"
      class="security-form"
    >
      <div class="security-fields">
        <label>
          –ù–æ–≤—ã–π email:
          <input type="email" [(ngModel)]="newEmail" name="newEmail" required />
        </label>
        <button
          class="primary-btn"
          type="submit"
          [disabled]="emailForm.invalid"
        >
          –ò–∑–º–µ–Ω–∏—Ç—å email
        </button>
      </div>
    </form>
    <form
      (ngSubmit)="changePassword()"
      #pwdForm="ngForm"
      autocomplete="off"
      class="security-form"
    >
      <div class="security-fields">
        <label>
          –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:
          <input
            type="password"
            [(ngModel)]="newPassword"
            name="newPassword"
            required
            minlength="6"
          />
        </label>
        <label>
          –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å:
          <input
            type="password"
            [(ngModel)]="repeatPassword"
            name="repeatPassword"
            required
            [pattern]="newPassword"
          />
        </label>
        <button
          class="primary-btn"
          type="submit"
          [disabled]="pwdForm.invalid || newPassword !== repeatPassword"
        >
          –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
        </button>
      </div>
    </form>
    <div *ngIf="smsRequired" class="sms-confirm">
      <label>
        –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS:
        <input type="text" [(ngModel)]="smsCode" name="smsCode" maxlength="6" />
      </label>
      <button class="primary-btn" (click)="confirmSmsCode()">
        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
      </button>
    </div>
    <div class="security-hint">
      –ü–æ—Å–ª–µ —Å–º–µ–Ω—ã email –∏–ª–∏ –ø–∞—Ä–æ–ª—è –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SMS –∫–æ–¥.
    </div>
  </section>
</div>
